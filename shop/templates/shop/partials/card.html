{# templates/shop/partials/card.html #}
{% load i18n static %}

<div class="card h-100 border-0 shadow-sm rounded-3 product-card position-relative">
  {# create href using the routes above #}
  {% if product.slug %}
    {% url 'shop:product_detail' slug=product.slug as detail_href %}
  {% else %}
    {% url 'shop:product_detail_by_id' pk=product.pk as detail_href %}
  {% endif %}

  <a href="{{ detail_href }}" class="stretched-link" aria-label="{{ product.display_title|default:_('Produkt') }}"></a>

  {% if product.sale_price and product.price and product.sale_price < product.price %}
    <div class="badge bg-dark text-white position-absolute rounded-pill px-3 py-2" style="top:.75rem; right:.75rem;">
      {% trans "Angebot" %}
    </div>
  {% endif %}

  <div class="card-img-top ratio ratio-1x1 overflow-hidden">
    {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.display_title }}" class="w-100 h-100 object-fit-cover rounded-top-3">
    {% else %}
      <img src="{% static 'shop/assets/placeholder.png' %}" alt="{{ product.display_title }}" class="w-100 h-100 object-fit-cover rounded-top-3">
    {% endif %}
  </div>

  <div class="card-body p-4 text-center">
    <h5 class="fw-bold">{{ product.display_title }}</h5>

    {% if product.sale_price and product.price and product.sale_price < product.price %}
      <div>
        <span class="text-muted text-decoration-line-through">{{ product.price }} €</span>
        <span class="fw-semibold ms-2">{{ product.sale_price }} €</span>
      </div>
    {% else %}
      <div class="fw-semibold">{{ product.price }} €</div>
    {% endif %}
  </div>

  <div class="card-footer bg-white border-0 text-center pb-4">
    <form method="post" action="{% url 'shop:cart_add' %}" class="add-to-cart-form" data-ajax="1">
      {% csrf_token %}
      <input type="hidden" name="product_id" value="{{ product.id }}">
      <input type="hidden" name="qty" value="1">
      <button class="btn btn-outline-dark rounded-3 px-4 py-2 fw-semibold" type="submit" style="position:relative; z-index:2;">
        {% trans "In den Warenkorb" %}
      </button>
    </form>
  </div>
</div>
